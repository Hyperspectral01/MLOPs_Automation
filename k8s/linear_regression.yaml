apiVersion: batch/v1
kind: Job
metadata:
  name: linear-regression
  namespace: ml
  labels:
    app: linear-regression
spec:
  backoffLimit: 2          # Retry failed jobs up to 2 times
  template:
    metadata:
      labels:
        app: linear-regression
    spec:
      serviceAccountName: ml-service-account

      containers:
        - name: linear-regression
          image: gcr.io/mlops-476802/linear_regression:$SHORT_SHA
          imagePullPolicy: Always
          env:
            - name: BUCKET_2
              valueFrom:
                configMapKeyRef:
                  name: confmap-1
                  key: BUCKET_2

          resources:
            requests:
              cpu: "250m"
              memory: "512Mi"
            limits:
              cpu: "1000m"
              memory: "1Gi"

      restartPolicy: Never   #  ensures it doesnâ€™t restart after finishing
